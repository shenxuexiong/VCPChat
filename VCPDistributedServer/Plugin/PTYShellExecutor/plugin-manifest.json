{
  "manifestVersion": "1.0.0",
  "name": "PTYShellExecutor",
  "version": "1.0.0",
  "displayName": "PTY Shell 执行器",
  "description": "一个在Linux桌面环境下执行本地Shell命令的插件。使用node-pty创建持久化的PTY会话，支持bash/fish/zsh等Shell，保持环境变量和会话状态。支持同步执行和异步任务模式，自动过滤ANSI转义序列和Shell Integration标记，返回干净的文本输出。",
  "author": "Piko & 十一",
  "pluginType": "hybridservice",
  "entryPoint": {
    "type": "nodejs",
    "script": "PTYShellExecutor.js"
  },
  "communication": {
    "protocol": "direct",
    "timeout": 600000
  },
  "capabilities": {
    "invocationCommands": [
      {
        "commandIdentifier": "PTYShellExecutor",
        "description": "在Linux桌面环境下执行本地Shell命令。支持同步执行（PTY会话）和异步任务模式（后台执行长时间任务如codex）。\n\n## 操作模式 (action 参数)\n\n### 1. 同步执行 (默认)\naction: \"execute\" 或省略\n在PTY会话中执行命令，保持环境变量和会话状态。\n\n### 2. 异步执行\naction: \"async\"\n将命令放到后台执行，立即返回taskId。适用于长时间运行的任务（如codex、编译等）。\n\n### 3. 查询任务\naction: \"query\" 或 \"eventlog\"\n查询异步任务的状态和输出。\n\n### 4. 取消任务\naction: \"cancel\"\n取消正在运行的异步任务。\n\n### 5. 列出任务\naction: \"list\"\n列出所有异步任务。\n\n## 参数说明\n- action (字符串, 可选): 操作类型，可选值: 'execute'(默认), 'async', 'query', 'cancel', 'list'\n- command (字符串, execute/async时必需): 要执行的Shell命令\n- taskId (字符串, query/cancel时必需): 异步任务ID\n- shell (字符串, 可选): 指定Shell类型: 'fish', 'zsh', 'bash'\n- newSession (布尔值, 可选): 是否创建新的PTY会话\n- cwd (字符串, 可选): 工作目录","parameters": [
          {
            "name": "action",
            "type": "string",
            "required": false,
            "description": "操作类型: execute(同步执行), async(异步执行), query(查询任务), cancel(取消任务), list(列出任务)"
          },
          {
            "name": "command",
            "type": "string",
            "required": false,
            "description": "要执行的Shell命令 (execute/async模式必需)"
          },
          {
            "name": "taskId",
            "type": "string",
            "required": false,
            "description": "异步任务ID (query/cancel模式必需)"
          },
          {
            "name": "shell",
            "type": "string",
            "required": false,
            "description": "指定Shell类型: fish, zsh, bash"
          },
          {
            "name": "newSession",
            "type": "boolean",
            "required": false,
            "description": "是否创建新的PTY会话"
          },
          {
            "name": "cwd",
            "type": "string",
            "required": false,
            "description": "工作目录 (async模式可用)"
          }
        ],
        "examples": [
          {
            "name": "同步执行命令",
            "description": "在PTY会话中执行ls命令",
            "code": "<<<[TOOL_REQUEST]>>>\ntool_name:「始」PTYShellExecutor「末」,\ncommand:「始」ls -la「末」,\n<<<[END_TOOL_REQUEST]>>>"
          },
          {
            "name": "异步执行长任务",
            "description": "后台执行codex命令",
            "code": "<<<[TOOL_REQUEST]>>>\ntool_name:「始」PTYShellExecutor「末」,\naction:「始」async「末」,\ncommand:「始」codex generate --prompt 'create a hello world'「末」,\n<<<[END_TOOL_REQUEST]>>>"
          },
          {
            "name": "查询任务状态",
            "description": "查询异步任务的输出",
            "code": "<<<[TOOL_REQUEST]>>>\ntool_name:「始」PTYShellExecutor「末」,\naction:「始」query「末」,\ntaskId:「始」task_xxx_yyy「末」,\n<<<[END_TOOL_REQUEST]>>>"
          },
          {
            "name": "列出所有任务",
            "description": "查看所有异步任务",
            "code": "<<<[TOOL_REQUEST]>>>\ntool_name:「始」PTYShellExecutor「末」,\naction:「始」list「末」,\n<<<[END_TOOL_REQUEST]>>>"
          }
        ]
      }
    ]
  },
  "configSchema": {
    "SHELL_RETURN_MODE": {
      "type": "string",
      "description": "返回模式: delta (仅返回增量输出) 或 full (返回完整终端内容)",
      "default": "delta"
    },
    "SHELL_PRIORITY": {
      "type": "string",
      "description": "默认Shell优先级 (逗号分隔)",
      "default": "fish,zsh,bash"
    },
    "FORBIDDEN_COMMANDS": {
      "type": "string",
      "description": "禁止执行的命令关键字 (逗号分隔)",
      "default": ""
    },
    "AUTH_REQUIRED_COMMANDS": {
      "type": "string",
      "description": "需要确认的命令关键字 (逗号分隔)",
      "default": ""
    },
    "COMMAND_TIMEOUT": {
      "type": "integer",
      "description": "命令执行超时时间 (毫秒)",
      "default": 60000
    }
  },
  "requiresAdmin": false
}