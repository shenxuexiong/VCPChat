<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src * data: file:; connect-src *;">
    <title>VCP Memo 中心</title>
    <!-- 引入主题和样式 -->
    <link rel="stylesheet" href="../styles/themes.css">
    <link rel="stylesheet" href="../Forummodules/forum.css">
    <link rel="stylesheet" href="memo.css">
    <!-- KaTeX for LaTeX rendering -->
    <link rel="stylesheet" href="../vendor/katex.min.css">
    <script defer src="../vendor/katex.min.js"></script>
    <script defer src="../vendor/auto-render.min.js"></script>
    <script src="../vendor/marked.min.js"></script>
</head>
<body>
    <!-- 沉浸式顶部导航栏 -->
    <nav id="top-nav-bar" class="glass">
        <div class="nav-left">
            <div class="nav-title">VCP Memo</div>
            <div style="width: 1px; height: 20px; background: var(--glass-border); margin: 0 10px;"></div>
            <div class="search-container" style="display: flex; align-items: center; gap: 8px;">
                <input type="search" id="search-memos" class="search-glass" placeholder="🔍 搜索日记...">
                <button id="search-scope-btn" class="nav-icon-btn scope-toggle-btn" title="当前范围：文件夹内">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></svg>
                </button>
            </div>
        </div>
        <div class="nav-right">
            <button id="create-memo-btn" class="jelly-btn" style="width: auto; padding: 8px 20px; font-size: 0.9rem;">
                + 新建日记
            </button>
            
            <div style="width: 1px; height: 20px; background: var(--glass-border); margin: 0 10px;"></div>
            
            <button id="minimize-memo-btn" class="nav-icon-btn" title="最小化">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="5" y1="12" x2="19" y2="12"></line></svg>
            </button>
            <button id="maximize-memo-btn" class="nav-icon-btn" title="最大化">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect></svg>
            </button>
            <button id="close-memo-btn" class="nav-icon-btn" title="关闭" style="color: var(--danger-color); opacity: 1;">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </button>
        </div>
    </nav>

    <div class="app-layout">
        <!-- 侧边栏：文件夹列表 -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <span>文件夹</span>
                <button id="refresh-folders-btn" class="nav-icon-btn" title="刷新">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 4v6h-6"></path><path d="M1 20v-6h6"></path><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path></svg>
                </button>
            </div>
            <div id="folder-list" class="folder-list">
                <!-- 文件夹项将由 JS 动态生成 -->
                <div class="folder-item active">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></svg>
                    <span>加载中...</span>
                </div>
            </div>
            <div class="sidebar-footer" style="padding: 10px; border-top: 1px solid var(--glass-border);">
                <button id="manage-hidden-btn" class="glass-btn" style="width: 100%; justify-content: center;">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                    管理隐藏文件夹
                </button>
            </div>
        </aside>

        <!-- 主内容区：日记列表 -->
        <main class="main-content">
            <div class="content-header">
                <div id="current-folder-name" class="folder-title">所有日记</div>
                <div class="header-actions" style="display: flex; gap: 10px;">
                    <button id="batch-edit-btn" class="glass-btn">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121(0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>
                        批量管理
                    </button>
                    <div id="batch-actions" style="display: none; gap: 10px; align-items: center; background: rgba(255,255,255,0.05); padding: 5px 15px; border-radius: 10px; border: 1px solid var(--glass-border);">
                        <span id="selected-count" style="font-size: 0.85rem; color: var(--accent-color); font-weight: bold;">已选 0 项</span>
                        <div style="display: flex; align-items: center; gap: 5px;">
                            <span style="font-size: 0.75rem; color: var(--text-secondary);">移动到:</span>
                            <select id="batch-move-select" class="glass-input" style="padding: 2px 10px; font-size: 0.8rem; width: auto; margin-bottom: 0;">
                                <option value="">-- 选择文件夹 --</option>
                            </select>
                        </div>
                        <button id="batch-delete-btn" class="glass-btn danger" style="padding: 5px 12px; font-size: 0.85rem;">🗑️ 批量删除</button>
                        <button id="cancel-batch-btn" class="nav-icon-btn" title="取消">&times;</button>
                    </div>
                </div>
            </div>
            <div id="memo-grid" class="memo-grid">
                <!-- 日记卡片将由 JS 动态生成 -->
            </div>
        </main>
    </div>

    <!-- 编辑器/详情 弹窗 -->
    <div id="editor-overlay" class="editor-overlay">
        <div class="editor-container">
            <div class="editor-header">
                <input type="text" id="editor-title" class="editor-title-input" placeholder="日记标题...">
                <button id="close-editor-btn" class="nav-icon-btn" style="font-size: 1.5rem;">&times;</button>
            </div>
            <div class="editor-body">
                <textarea id="editor-textarea" class="editor-textarea" placeholder="开始记录你的灵感... (支持 Markdown)"></textarea>
                <div id="editor-preview" class="editor-preview markdown-body"></div>
            </div>
            <div class="editor-footer">
                <p id="editor-status" style="margin-right: auto; font-size: 0.8rem; color: var(--text-secondary);"></p>
                <button id="delete-memo-btn" class="glass-btn danger">🗑️ 删除</button>
                <button id="save-memo-btn" class="glass-btn primary">💾 保存修改</button>
            </div>
        </div>
    </div>

    <!-- 新建日记 弹窗 -->
    <div id="create-modal" class="modal" style="display: none; align-items: center; justify-content: center; position: fixed; top:0; left:0; right:0; bottom:0; z-index: 3000; background: rgba(0,0,0,0.6); backdrop-filter: blur(10px);">
        <div class="modal-glass-content glass" style="width: 90%; max-width: 600px; padding: 30px; border-radius: 20px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 style="margin: 0;">📝 新建日记</h2>
                <button id="close-create-modal-btn" class="nav-icon-btn" style="font-size: 1.5rem;">&times;</button>
            </div>
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px; font-size: 0.9rem; color: var(--text-secondary);">日期</label>
                <input type="date" id="new-memo-date" class="glass-input" style="width: 100%;">
            </div>
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px; font-size: 0.9rem; color: var(--text-secondary);">文件夹</label>
                <input type="text" id="new-memo-maid" class="glass-input" style="width: 100%;" placeholder="日记的目标文件夹">
            </div>
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 5px; font-size: 0.9rem; color: var(--text-secondary);">内容</label>
                <textarea id="new-memo-content" class="glass-input" style="width: 100%; min-height: 150px; resize: vertical;" placeholder="写下今天的故事..."></textarea>
            </div>
            <div style="display: flex; justify-content: flex-end; gap: 10px;">
                <button id="submit-new-memo-btn" class="jelly-btn" style="width: auto; padding: 10px 30px;">🚀 发布</button>
            </div>
        </div>
    </div>


    <!-- 自定义确认弹窗 -->
    <div id="custom-confirm-modal" class="modal" style="display: none; align-items: center; justify-content: center; position: fixed; top:0; left:0; right:0; bottom:0; z-index: 4000; background: rgba(0,0,0,0.6); backdrop-filter: blur(10px);">
        <div class="modal-glass-content glass" style="max-width: 450px; width: 90%; text-align: center; padding: 30px; border-radius: 20px;">
            <h3 id="confirm-title" style="margin-top: 0; margin-bottom: 15px; color: var(--accent-color);">确认操作</h3>
            <p id="confirm-message" style="margin-bottom: 25px; line-height: 1.6; color: var(--text-primary);"></p>
            <div style="display: flex; gap: 15px; justify-content: center;">
                <button id="confirm-cancel-btn" class="glass-btn" style="width: auto; padding: 10px 30px;">取消</button>
                <button id="confirm-ok-btn" class="jelly-btn" style="width: auto; padding: 10px 30px; background: var(--danger-color);">确定</button>
            </div>
        </div>
    </div>

    <!-- 自定义提示弹窗 -->
    <div id="custom-alert-modal" class="modal" style="display: none; align-items: center; justify-content: center; position: fixed; top:0; left:0; right:0; bottom:0; z-index: 4000; background: rgba(0,0,0,0.6); backdrop-filter: blur(10px);">
        <div class="modal-glass-content glass" style="max-width: 400px; width: 90%; text-align: center; padding: 30px; border-radius: 20px;">
            <h3 id="alert-title" style="margin-top: 0; margin-bottom: 15px; color: var(--accent-color);">提示</h3>
            <p id="alert-message" style="margin-bottom: 25px; line-height: 1.6; color: var(--text-primary);"></p>
            <button id="alert-ok-btn" class="jelly-btn" style="width: auto; padding: 10px 40px;">确定</button>
        </div>
    </div>

    <!-- 隐藏文件夹管理弹窗 -->
    <div id="hidden-folders-modal" class="modal" style="display: none; align-items: center; justify-content: center; position: fixed; top:0; left:0; right:0; bottom:0; z-index: 3000; background: rgba(0,0,0,0.6); backdrop-filter: blur(10px);">
        <div class="modal-glass-content glass" style="width: 90%; max-width: 500px; padding: 30px; border-radius: 20px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 style="margin: 0;">🙈 隐藏文件夹管理</h2>
                <button id="close-hidden-modal-btn" class="nav-icon-btn" style="font-size: 1.5rem;">&times;</button>
            </div>
            <div id="hidden-folders-list" style="max-height: 300px; overflow-y: auto; margin-bottom: 20px;">
                <!-- 隐藏文件夹列表将由 JS 动态生成 -->
            </div>
            <div style="display: flex; justify-content: flex-end;">
                <button id="hidden-modal-ok-btn" class="jelly-btn" style="width: auto; padding: 10px 40px;">完成</button>
            </div>
        </div>
    </div>

    <!-- 右键菜单 -->
    <div id="context-menu" class="context-menu glass" style="display: none; position: fixed; z-index: 5000; min-width: 120px; padding: 5px 0; border-radius: 10px; box-shadow: 0 10px 25px rgba(0,0,0,0.3);">
        <!-- 菜单项将由 JS 动态生成 -->
    </div>

    <!-- 批量操作悬浮条 -->
    <div id="batch-floating-bar" class="batch-floating-bar glass">
        <div class="batch-bar-header">
            <span id="batch-bar-count">已选择 0 项</span>
            <button id="batch-bar-clear" class="glass-btn" style="padding: 2px 8px; font-size: 0.7rem;">清空</button>
        </div>
        <div id="batch-bar-items" class="batch-bar-items">
            <!-- 选中项将在这里显示 -->
        </div>
    </div>

    <script src="memo.js"></script>
</body>
</html>